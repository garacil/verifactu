# Análisis de Privacidad y Protección de Datos - Módulo rd10072023

## Resumen Ejecutivo

El módulo `rd10072023` (Real Decreto 1007/2023) **transmite datos sensibles a un servidor externo (`rd.sgestion.net`) sin solicitar consentimiento explícito del usuario**. Esta práctica constituye una **violación potencial** de la normativa europea y española de protección de datos.

---

## 1. Evidencia de Transmisión de Datos

### 1.1 Función de Envío de Datos

**Ubicación:** `lib/rd10072023.lib.php` líneas 215-251

```php
function getRD10072023Integridad()
{
    global $conf, $db;
    $staticModRd10072023 = new modRD10072023($db);
    $url = "https://rd.sgestion.net/getDeclaracionResponsable";
    // Payload en formato JSON
    $payload = json_encode([
        "module_version" => $staticModRd10072023->version,
        "dolibarr_version" => DOL_VERSION,
        "serial" => $conf->global->RD10072023_SERIAL,
        "domain" =>  getRd10072023Domain(),
        "hash_integriy" => calculateRd10072023IntegrityChecksums(dol_buildpath('rd10072023'))
    ]);
    // ...
    $response = getURLContent($url, 'POST', $payload, ...);
}
```

### 1.2 Datos Transmitidos al Servidor Externo

| Campo | Descripción | Nivel de Sensibilidad |
|-------|-------------|----------------------|
| `module_version` | Versión del módulo instalado | Bajo |
| `dolibarr_version` | Versión de Dolibarr | Bajo |
| `serial` | Número de serie/licencia del módulo | **ALTO** - Identificador único |
| `domain` | Dominio/URL del servidor del usuario | **ALTO** - Identifica la empresa |
| `hash_integrity` | Hash SHA256 de archivos del sistema | Medio - Fingerprinting |

### 1.3 Puntos de Llamada

La función `getRD10072023Integridad()` se invoca desde:

1. **`declaracion_responsable.php:113`** - Al acceder a la página de declaración responsable
2. **`integrity.php:49`** - Endpoint público accesible sin autenticación

---

## 2. Ausencia de Mecanismos de Consentimiento

### 2.1 Búsqueda de Términos de Consentimiento

Se realizó una búsqueda exhaustiva de los siguientes términos en todo el módulo:
- `consent` / `consentimiento`
- `GDPR` / `RGPD`
- `LOPD` / `LOPDGDD`
- `privacidad` / `privacy`
- `acepto` / `accept`

**Resultado:** NO se encontró ninguna implementación de:
- Checkbox de consentimiento
- Política de privacidad
- Información sobre transmisión de datos
- Opción para rechazar el envío de datos

### 2.2 Archivo de Configuración (admin/setup.php)

El archivo de configuración solo solicita:
- `RD10072023_SERIAL` - Número de serie
- `RD10072023_OCULTAR_BANDERA` - Opción estética

**No existe ninguna opción para:**
- Deshabilitar la transmisión de datos
- Informar sobre qué datos se envían
- Solicitar consentimiento

### 2.3 Archivo de Idioma (langs/es_ES/rd10072023.lang)

El texto del tooltip del serial indica:
> "Número de serie del módulo, se utiliza para verificar la autenticidad del módulo y obtener la declaracion responsable."

**NO menciona que los datos se envían a un servidor externo.**

---

## 3. Violaciones Legales Identificadas

### 3.1 Reglamento General de Protección de Datos (RGPD) - UE 2016/679

#### Artículo 6 - Licitud del tratamiento
> "El tratamiento solo será lícito si se cumple al menos una de las siguientes condiciones: a) el interesado dio su consentimiento..."

**VIOLACIÓN:** No se solicita consentimiento para la transmisión de datos identificativos (dominio empresarial, serial).

#### Artículo 7 - Condiciones para el consentimiento
> "El responsable del tratamiento deberá ser capaz de demostrar que el interesado consintió el tratamiento de sus datos personales."

**VIOLACIÓN:** No existe registro ni mecanismo de consentimiento.

#### Artículo 13 - Información al interesado
> "Cuando se obtengan de un interesado datos personales relativos a él, el responsable del tratamiento, en el momento en que estos se obtengan, le facilitará toda la información indicada..."

**VIOLACIÓN:** No se informa sobre:
- Identidad del responsable del tratamiento
- Fines del tratamiento
- Destinatarios de los datos
- Plazo de conservación
- Derechos del interesado

#### Artículo 14 - Información cuando los datos no se obtienen del interesado
> "Cuando los datos personales no se hayan obtenido del interesado, el responsable del tratamiento le facilitará la siguiente información..."

**VIOLACIÓN:** El dominio del servidor se obtiene automáticamente sin informar al usuario.

### 3.2 Ley Orgánica 3/2018, de 5 de diciembre (LOPDGDD) - España

#### Artículo 6 - Tratamiento basado en el consentimiento del afectado
> "El tratamiento basado en el consentimiento del afectado será lícito cuando se otorgue de forma libre, inequívoca, específica e informada."

**VIOLACIÓN:** No existe consentimiento de ningún tipo.

#### Artículo 11 - Transparencia e información al afectado
> "Los responsables del tratamiento deberán facilitar a los afectados, con anterioridad al inicio del tratamiento, la información básica..."

**VIOLACIÓN:** No se proporciona información previa sobre la transmisión de datos.

### 3.3 Ley 34/2002 de Servicios de la Sociedad de la Información (LSSI)

#### Artículo 22 - Derechos de los destinatarios de servicios
> "Los prestadores de servicios podrán utilizar dispositivos de almacenamiento y recuperación de datos [...] a condición de que los destinatarios de los servicios hayan dado su consentimiento..."

**VIOLACIÓN:** Se envían datos identificativos del servidor sin consentimiento.

---

## 4. Análisis de Riesgos

### 4.1 Datos que Permiten Identificación

| Dato | Riesgo |
|------|--------|
| `domain` | Identifica unívocamente la empresa/servidor |
| `serial` | Vincula la instalación con un cliente específico |
| Combinación de ambos | Permite tracking completo de la actividad |

### 4.2 Finalidades No Declaradas

El servidor `rd.sgestion.net` recibe información que permite:
1. **Inventariar** todas las instalaciones del módulo
2. **Identificar** qué empresas usan el software
3. **Monitorear** versiones y actualizaciones
4. **Vincular** dominios con licencias/seriales
5. **Potencialmente bloquear** instalaciones remotamente

### 4.3 Servidor de Destino

- **URL:** `https://rd.sgestion.net/getDeclaracionResponsable`
- **Propietario:** sgestion.net (Alberto Luque Rivas / easysoft.es)
- **Sin política de privacidad visible en el código**

---

## 5. Endpoint Público sin Autenticación

### 5.1 Archivo integrity.php

```php
if (! defined('NOREQUIREUSER'))  define('NOREQUIREUSER', '1');
if (! defined('NOREQUIREMENU'))  define('NOREQUIREMENU', '1');
if (! defined('NOLOGIN'))        define('NOLOGIN', '1');
```

Este endpoint:
- No requiere autenticación (`NOLOGIN`)
- Expone públicamente la función `getRD10072023Integridad()`
- Devuelve información del sistema en formato JSON
- Puede ser llamado por cualquier tercero para extraer información

**Riesgo adicional:** Un atacante podría enumerar instalaciones de Dolibarr escaneando este endpoint.

---

## 6. Tabla Resumen de Violaciones

| Normativa | Artículo | Descripción | Gravedad |
|-----------|----------|-------------|----------|
| RGPD | Art. 6 | Falta de base legal para el tratamiento | **GRAVE** |
| RGPD | Art. 7 | Ausencia de consentimiento demostrable | **GRAVE** |
| RGPD | Art. 13 | Falta de información al interesado | **GRAVE** |
| RGPD | Art. 14 | No información sobre datos automáticos | **MODERADA** |
| LOPDGDD | Art. 6 | Tratamiento sin consentimiento libre e informado | **GRAVE** |
| LOPDGDD | Art. 11 | Falta de transparencia | **GRAVE** |
| LSSI | Art. 22 | Transmisión sin consentimiento | **MODERADA** |

---

## 7. Sanciones Potenciales

### 7.1 Según RGPD (Art. 83)

- **Infracciones graves (Art. 6, 7, 13):** Hasta 20.000.000 € o 4% del volumen de negocio anual global
- **Infracciones menos graves:** Hasta 10.000.000 € o 2% del volumen de negocio anual global

### 7.2 Según LOPDGDD (Art. 72-74)

- **Infracciones muy graves:** 300.001 € a 20.000.000 €
- **Infracciones graves:** 40.001 € a 300.000 €
- **Infracciones leves:** Hasta 40.000 €

---

## 8. Conclusiones

1. **El módulo rd10072023 transmite datos identificativos a un servidor externo (rd.sgestion.net) sin consentimiento.**

2. **No existe ningún mecanismo de consentimiento, ni informativo, ni técnico.**

3. **La información transmitida permite identificar unívocamente empresas y sus instalaciones.**

4. **El código viola múltiples artículos del RGPD y la LOPDGDD española.**

5. **El endpoint integrity.php expone información sin autenticación, creando un riesgo de seguridad adicional.**

6. **El usuario del módulo podría ser considerado corresponsable del tratamiento ilícito.**

---

## 9. Recomendaciones

Para el **usuario del módulo:**
1. Desinstalar el módulo si no se puede garantizar el cumplimiento normativo
2. Consultar con un DPO (Delegado de Protección de Datos)
3. Documentar el uso para posibles auditorías

Para el **desarrollador del módulo:**
1. Implementar consentimiento explícito antes de cualquier transmisión
2. Proporcionar política de privacidad clara
3. Permitir uso offline sin transmisión de datos
4. Documentar qué datos se envían y con qué finalidad
5. Proteger el endpoint integrity.php con autenticación

---

## 10. Referencias Legales

- [Reglamento (UE) 2016/679 (RGPD)](https://eur-lex.europa.eu/legal-content/ES/TXT/?uri=CELEX%3A32016R0679)
- [Ley Orgánica 3/2018 (LOPDGDD)](https://www.boe.es/buscar/act.php?id=BOE-A-2018-16673)
- [Ley 34/2002 (LSSI)](https://www.boe.es/buscar/act.php?id=BOE-A-2002-13758)

---

*Informe generado el: 2025-12-10*
*Versión del módulo analizado: rd10072023 v1.4*
*Autor del módulo: Alberto Luque Rivas (sgestion.net / easysoft.es)*
