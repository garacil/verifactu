# Privacy and Data Protection Analysis - rd10072023 Module

## Executive Summary

The `rd10072023` module (Royal Decree 1007/2023) **transmits sensitive data to an external server (`rd.sgestion.net`) without requesting explicit consent from the user**. This practice constitutes a **potential violation** of European and Spanish data protection regulations.

---

## 1. Evidence of Data Transmission

### 1.1 Data Sending Function

**Location:** `lib/rd10072023.lib.php` lines 215-251

```php
function getRD10072023Integridad()
{
    global $conf, $db;
    $staticModRd10072023 = new modRD10072023($db);
    $url = "https://rd.sgestion.net/getDeclaracionResponsable";
    // Payload in JSON format
    $payload = json_encode([
        "module_version" => $staticModRd10072023->version,
        "dolibarr_version" => DOL_VERSION,
        "serial" => $conf->global->RD10072023_SERIAL,
        "domain" =>  getRd10072023Domain(),
        "hash_integriy" => calculateRd10072023IntegrityChecksums(dol_buildpath('rd10072023'))
    ]);
    // ...
    $response = getURLContent($url, 'POST', $payload, ...);
}
```

### 1.2 Data Transmitted to External Server

| Field | Description | Sensitivity Level |
|-------|-------------|-------------------|
| `module_version` | Installed module version | Low |
| `dolibarr_version` | Dolibarr version | Low |
| `serial` | Module serial/license number | **HIGH** - Unique identifier |
| `domain` | User's server domain/URL | **HIGH** - Identifies the company |
| `hash_integrity` | SHA256 hash of system files | Medium - Fingerprinting |

### 1.3 Call Points

The `getRD10072023Integridad()` function is invoked from:

1. **`declaracion_responsable.php:113`** - When accessing the responsible declaration page
2. **`integrity.php:49`** - Public endpoint accessible without authentication

---

## 2. Absence of Consent Mechanisms

### 2.1 Search for Consent Terms

An exhaustive search was performed for the following terms throughout the module:
- `consent` / `consentimiento`
- `GDPR` / `RGPD`
- `LOPD` / `LOPDGDD`
- `privacidad` / `privacy`
- `acepto` / `accept`

**Result:** NO implementation was found of:
- Consent checkbox
- Privacy policy
- Information about data transmission
- Option to reject data sending

### 2.2 Configuration File (admin/setup.php)

The configuration file only requests:
- `RD10072023_SERIAL` - Serial number
- `RD10072023_OCULTAR_BANDERA` - Aesthetic option

**There is no option to:**
- Disable data transmission
- Inform about what data is sent
- Request consent

### 2.3 Language File (langs/es_ES/rd10072023.lang)

The serial tooltip text indicates:
> "Module serial number, used to verify the authenticity of the module and obtain the responsible declaration."

**Does NOT mention that data is sent to an external server.**

---

## 3. Identified Legal Violations

### 3.1 General Data Protection Regulation (GDPR) - EU 2016/679

#### Article 6 - Lawfulness of processing
> "Processing shall be lawful only if and to the extent that at least one of the following applies: (a) the data subject has given consent..."

**VIOLATION:** Consent is not requested for the transmission of identifying data (business domain, serial).

#### Article 7 - Conditions for consent
> "The controller shall be able to demonstrate that the data subject has consented to processing of his or her personal data."

**VIOLATION:** There is no record or consent mechanism.

#### Article 13 - Information to be provided to the data subject
> "Where personal data relating to a data subject are collected from the data subject, the controller shall, at the time when personal data are obtained, provide the data subject with all of the following information..."

**VIOLATION:** No information is provided about:
- Identity of the data controller
- Purposes of processing
- Recipients of the data
- Retention period
- Data subject rights

#### Article 14 - Information where personal data have not been obtained from the data subject
> "Where personal data have not been obtained from the data subject, the controller shall provide the data subject with the following information..."

**VIOLATION:** The server domain is obtained automatically without informing the user.

### 3.2 Organic Law 3/2018, of December 5 (LOPDGDD) - Spain

#### Article 6 - Processing based on the data subject's consent
> "Processing based on the data subject's consent shall be lawful when given freely, unambiguously, specifically and informedly."

**VIOLATION:** There is no consent of any kind.

#### Article 11 - Transparency and information to the data subject
> "Data controllers must provide data subjects, prior to the start of processing, with basic information..."

**VIOLATION:** No prior information is provided about data transmission.

### 3.3 Law 34/2002 on Information Society Services (LSSI)

#### Article 22 - Rights of service recipients
> "Service providers may use storage and data retrieval devices [...] provided that service recipients have given their consent..."

**VIOLATION:** Identifying server data is sent without consent.

---

## 4. Risk Analysis

### 4.1 Data Enabling Identification

| Data | Risk |
|------|------|
| `domain` | Uniquely identifies the company/server |
| `serial` | Links the installation to a specific customer |
| Combination of both | Allows complete activity tracking |

### 4.2 Undeclared Purposes

The `rd.sgestion.net` server receives information that allows:
1. **Inventory** of all module installations
2. **Identification** of which companies use the software
3. **Monitoring** of versions and updates
4. **Linking** domains with licenses/serials
5. **Potentially blocking** installations remotely

### 4.3 Destination Server

- **URL:** `https://rd.sgestion.net/getDeclaracionResponsable`
- **Owner:** sgestion.net (Alberto Luque Rivas / easysoft.es)
- **No privacy policy visible in the code**

---

## 5. Public Endpoint without Authentication

### 5.1 integrity.php File

```php
if (! defined('NOREQUIREUSER'))  define('NOREQUIREUSER', '1');
if (! defined('NOREQUIREMENU'))  define('NOREQUIREMENU', '1');
if (! defined('NOLOGIN'))        define('NOLOGIN', '1');
```

This endpoint:
- Does not require authentication (`NOLOGIN`)
- Publicly exposes the `getRD10072023Integridad()` function
- Returns system information in JSON format
- Can be called by any third party to extract information

**Additional risk:** An attacker could enumerate Dolibarr installations by scanning this endpoint.

---

## 6. Summary Table of Violations

| Regulation | Article | Description | Severity |
|------------|---------|-------------|----------|
| GDPR | Art. 6 | Lack of legal basis for processing | **SERIOUS** |
| GDPR | Art. 7 | Absence of demonstrable consent | **SERIOUS** |
| GDPR | Art. 13 | Lack of information to data subject | **SERIOUS** |
| GDPR | Art. 14 | No information about automatic data | **MODERATE** |
| LOPDGDD | Art. 6 | Processing without free and informed consent | **SERIOUS** |
| LOPDGDD | Art. 11 | Lack of transparency | **SERIOUS** |
| LSSI | Art. 22 | Transmission without consent | **MODERATE** |

---

## 7. Potential Sanctions

### 7.1 Under GDPR (Art. 83)

- **Serious infringements (Art. 6, 7, 13):** Up to €20,000,000 or 4% of global annual turnover
- **Less serious infringements:** Up to €10,000,000 or 2% of global annual turnover

### 7.2 Under LOPDGDD (Art. 72-74)

- **Very serious infringements:** €300,001 to €20,000,000
- **Serious infringements:** €40,001 to €300,000
- **Minor infringements:** Up to €40,000

---

## 8. Conclusions

1. **The rd10072023 module transmits identifying data to an external server (rd.sgestion.net) without consent.**

2. **There is no consent mechanism, neither informative nor technical.**

3. **The transmitted information allows unique identification of companies and their installations.**

4. **The code violates multiple articles of GDPR and Spanish LOPDGDD.**

5. **The integrity.php endpoint exposes information without authentication, creating an additional security risk.**

6. **The module user could be considered co-responsible for the unlawful processing.**

---

## 9. Recommendations

For **module users:**
1. Uninstall the module if regulatory compliance cannot be guaranteed
2. Consult with a DPO (Data Protection Officer)
3. Document usage for possible audits

For **module developers:**
1. Implement explicit consent before any transmission
2. Provide a clear privacy policy
3. Allow offline use without data transmission
4. Document what data is sent and for what purpose
5. Protect the integrity.php endpoint with authentication

---

## 10. Legal References

- [Regulation (EU) 2016/679 (GDPR)](https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32016R0679)
- [Organic Law 3/2018 (LOPDGDD)](https://www.boe.es/buscar/act.php?id=BOE-A-2018-16673)
- [Law 34/2002 (LSSI)](https://www.boe.es/buscar/act.php?id=BOE-A-2002-13758)

---

*Report generated on: 2025-12-10*
*Analyzed module version: rd10072023 v1.4*
*Module author: Alberto Luque Rivas (sgestion.net / easysoft.es)*
